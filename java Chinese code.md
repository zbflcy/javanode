## java 中文编码问题

[TOC]

### 几种常见的编码格式

#### 为什么需要编码
  1. 计算机中存储信息的最小单元是一个字节，8个bit,能够表示的字符是0-255个
  2. 人类要表示的符号太多，无法用一个字节
  3. 要解决这个问题，需要一个新的数据结构，char，从char到byte必须编码

#### 如何翻译
计算中提供了多种编码方式，常见的ASCII、ISO-8859-1、GB2312、GBK、UTF-8、UTF-16  
* ASCII编码  
>ASCII编码总共128个，用一个字节的低7字节表示，0-31控制换行回车删除；32-126是打印字符，能够通过键盘显示出来

* ISO-8859-1
>128个字符显然是不够用的，ISO-8859-1涵盖了大多数西欧语言，仍然是单字节，总共256个字符
* GB2312  
>信息交换用汉字编码字符集 基本集 ,采用双字节编码，总的编码范围是 A1-F7，其中从 A1-A9 是符号区，总共包含 682 个符号，从 B0-F7 是汉字区，包含 6763 个汉字。

* GBK
>全称叫《汉字内码扩展规范》，是国家技术监督局为 windows95 所制定的新的汉字内码规范，它的出现是为了扩展 GB2312，加入更多的汉字，它的编码范围是 8140~FEFE（去掉 XX7F）总共有 23940 个码位，它能表示 21003 个汉字，它的编码是和 GB2312 兼容的，也就是说用 GB2312 每个编码区域有不同的字码长度汉字可以用 GBK 来解码，并且不会有乱码

* UTF-16
>说到 UTF 必须要提到 Unicode（Universal Code 统一码），ISO 试图想创建一个全新的超语言字典，世界上所有的语言都可以通过这本字典来相互翻译。可想而知这个字典是多么的复杂，关于 Unicode 的详细规范可以参考相应文档。Unicode 是 Java 和 XML 的基础，下面详细介绍 Unicode 在计算机中的存储形式。   
>UTF-16定义了Unicode字符在计算机中的存取方法。用两个字节表示Unicode转化格式，这个是定长的表示方法，不论什么字符都可以使用两个字节来表示，两个字节就是16-bit,所以叫UTF-16。  
>***java以UTF-16（Unicode）作为内存中的字符存储格式，***
* UTF-8
>UTF-16采用两个字节表示字符，虽然简化了表示，但是却浪费了很多空间，有很大一部分字符用一个字节就够了，现在用两个字节表示，存储空间放大了一倍。UTF-8则采用了一种变长技术，每个编码区域有不同的字码长度，不同类型的字符可以是1-6个字节。  
>UTF-8有以下编码规则:  
>1. 如果一个字节，最高位（第8位）为0，表示这是一个ASCII编码（00-7F）。可见，所有的ASCII编码已经是UTF-8编码了。  
>2. 如果一个字节，以11开头，连续的1的个数表示这个字符的字节数，例如:1110xxxx表示他是三个字节的UTF-8的首字节。  
>3. 如果一个字节，以10开头，表示这个字节不是首字节，需要向前查找才能找到当前字符的首字节。

### java中需要编码的场景
#### IO操作中存在的编码
我们知道涉及到编码的地方一般都在字符到字节或者字节到字符的转换上，而需要这种转换的场景主要是在 I/O 的时候，这个 I/O 包括磁盘 I/O 和网络 I/O，关于网络 I/O 部分在后面将主要以 Web 应用为例介绍。下图是 Java 中处理 I/O 问题的接口：
![stream and reader](assets/markdown-img-paste-20181029164729652.png)  
Reader是java中读取字符的父类，InputStream是java中读字节的父类，InputStreamReader是关联字符到字节桥梁，主要负责I/O过程中读取字节到字符的转换，具体的字节到字符的转换是由SteamDecoder完成的。在StreamDecoder解码过程中用户需要指定charset编码格式，如果没有指定，采用默认的编码格式，中文环境采用GBK
